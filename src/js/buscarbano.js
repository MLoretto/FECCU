//Crea los iconos para el usuario y los banos
const iconBano = '<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"><g>	<g transform="translate(0.000000,1006.000000) scale(0.100000,-0.100000)">		<path fill="#00BCD4" d="M306.138,10041.894c-17.212-1.738-24.448-2.9-36.802-6.099c-53.174-13.755-97.446-49.321-122.065-98.291			c-18.633-37.085-24.019-82.505-14.473-122.065c4.731-19.526,10.308-32.402,25.747-59.941			c16.782-29.873,19.629-34.541,49.092-79.424c6.904-10.518,15.947-24.414,20.044-30.889			c47.891-75.029,75.962-140.332,91.919-213.809c0.947-4.199,1.123-3.828,2.744,3.955c6.484,32.383,20.273,74.551,35.4,108.447			c18.867,42.178,38.184,75.859,78.555,136.846c28.047,42.539,35.293,54.531,49.346,82.28c15.762,31.03,18.926,39.316,23.076,59.331			c4.287,21.03,4.023,47.827-0.605,71.079c-7.207,35.566-26.035,69.219-53.672,95.859c-29.355,28.252-67.188,45.933-110.596,51.548			C336.484,10041.649,311.685,10042.455,306.138,10041.894z"/>	</g></g><path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M26.427,12.241c-0.003-0.021-1.058,0.063-1.061,0.043	c-0.732,0.073-0.412,0.053-1.148,0.108c-0.525,0.042-1.046,0.056-1.568,0.184c-0.635,0.153-1.252,0.317-1.817,0.653	c-0.314,0.187-0.542,0.458-0.7,0.77c-0.086,0.168-0.099,0.389-0.094,0.588c0.016,0.643,0.056,1.282,0.087,1.926	c0.002,0.04,0.009,0.074,0.018,0.113c0.051,0.293,0.096,0.586,0.153,0.876c0.07,0.347,0.14,0.688,0.222,1.03	c0.062,0.244,0.14,0.481,0.217,0.72c0.108,0.338,0.207,0.685,0.333,1.019c0.149,0.389,0.307,0.783,0.492,1.16	c0.234,0.479,0.489,0.956,0.751,1.423c0.153,0.275,0.338,0.538,0.517,0.8c0.184,0.27,0.354,0.552,0.569,0.792	c0.397,0.446,0.808,0.88,1.241,1.286c0.335,0.306,0.647,0.653,1.129,0.773c0.343,0.086,0.647,0.026,0.897-0.164	c0.184-0.138,0.325-0.37,0.411-0.585c0.172-0.441,0.036-0.962-0.347-1.274c-0.283-0.23-0.573-0.447-0.828-0.709	c-0.279-0.282-0.527-0.599-0.783-0.909c-0.253-0.313-0.527-0.612-0.748-0.951c-0.26-0.397-0.49-0.827-0.701-1.254	c-0.21-0.425-0.397-0.86-0.567-1.302c-0.114-0.298-0.187-0.613-0.272-0.923c-0.067-0.24-0.138-0.479-0.189-0.723	c-0.084-0.385-0.161-0.768-0.225-1.154c-0.031-0.182-0.056-0.375-0.023-0.554c0.018-0.096,0.158-0.224,0.257-0.242	c0.102-0.015,0.275,0.06,0.324,0.146c0.077,0.136,0.071,0.315,0.107,0.474c0.075,0.327,0.152,0.656,0.227,0.987	c0.023,0.099,0.031,0.208,0.066,0.303c0.167,0.456,0.331,0.912,0.517,1.36c0.222,0.539,0.45,1.07,0.703,1.592	c0.173,0.357,0.378,0.704,0.598,1.034c0.198,0.299,0.434,0.574,0.66,0.849c0.035,0.044,0.152,0.075,0.173,0.056	c0.086-0.08,0.151-0.18,0.217-0.281c0.167-0.25,0.335-0.501,0.497-0.76c0.253-0.409,0.528-0.811,0.747-1.242	c0.257-0.52,0.47-1.059,0.686-1.597c0.148-0.377,0.294-0.768,0.388-1.162c0.123-0.516,0.197-1.046,0.284-1.571	c0.038-0.224,0.203-0.392,0.406-0.379c0.195,0.014,0.336,0.169,0.323,0.397c-0.014,0.219-0.052,0.436-0.097,0.651	c-0.088,0.428-0.174,0.855-0.287,1.272c-0.093,0.343-0.219,0.677-0.339,1.015c-0.16,0.456-0.317,0.917-0.499,1.368	c-0.115,0.288-0.253,0.571-0.401,0.842c-0.239,0.431-0.477,0.864-0.75,1.27c-0.185,0.274-0.434,0.507-0.642,0.767	c-0.039,0.052-0.049,0.183-0.013,0.219c0.147,0.163,0.308,0.314,0.48,0.447c0.373,0.286,0.589,0.669,0.739,1.097	c0.045,0.133,0.097,0.161,0.192,0.046c0.205-0.242,0.425-0.468,0.607-0.722c0.212-0.286,0.397-0.602,0.581-0.908	c0.235-0.389,0.472-0.772,0.681-1.178c0.185-0.354,0.333-0.728,0.491-1.101c0.178-0.421,0.359-0.838,0.516-1.271	c0.119-0.323,0.208-0.653,0.3-0.983c0.09-0.327,0.168-0.652,0.244-0.983c0.075-0.322,0.144-0.648,0.209-0.972	c0.05-0.244,0.102-0.489,0.141-0.74c0.022-0.131,0.016-0.269,0.031-0.401c0.048-0.534,0.126-1.065,0.139-1.6	c0.008-0.305-0.163-0.597-0.404-0.778c-0.283-0.206-0.596-0.384-0.92-0.51c-0.372-0.144-0.769-0.236-1.164-0.316	c-0.303-0.063-0.619-0.072-0.928-0.109c-0.421-0.051-0.842-0.113-1.264-0.147C26.953,12.221,26.689,12.241,26.427,12.241z	 M38.234,21.691c0.16-0.259,0.305-0.44,0.402-0.641c0.182-0.413,0.348-0.837,0.523-1.263c0.105-0.258,0.213-0.522,0.299-0.791	c0.135-0.446,0.232-0.903,0.363-1.356c0.172-0.585,0.268-1.181,0.268-1.794c0-0.083-0.004-0.166,0.002-0.245	c0.035-0.309,0.148-0.406,0.441-0.397c0.236,0.011,0.273,0.066,0.273,0.403c0,0.345,0.008,0.69-0.012,1.035	c-0.016,0.267-0.049,0.534-0.104,0.793c-0.064,0.316-0.17,0.619-0.25,0.933c-0.047,0.193-0.064,0.393-0.121,0.583	c-0.098,0.307-0.209,0.609-0.334,0.903c-0.166,0.421-0.344,0.839-0.535,1.247c-0.199,0.433-0.424,0.854-0.619,1.286	c-0.039,0.075-0.039,0.208,0.008,0.28c0.18,0.278,0.383,0.542,0.568,0.816c0.227,0.319,0.449,0.645,0.674,0.971	c0.031,0.044,0.076,0.12,0.102,0.111c0.059-0.008,0.129-0.048,0.16-0.098c0.234-0.399,0.479-0.791,0.699-1.203	c0.205-0.381,0.389-0.776,0.563-1.177c0.156-0.369,0.287-0.745,0.428-1.124c0.072-0.212,0.15-0.43,0.205-0.649	c0.109-0.43,0.199-0.855,0.293-1.285c0.117-0.503,0.242-1.002,0.334-1.507c0.08-0.43,0.146-0.867,0.172-1.304	c0.051-0.797,0.084-1.598,0.09-2.399c0.004-0.172-0.119-0.379-0.242-0.512c-0.369-0.399-0.896-0.496-1.395-0.614	c-0.408-0.097-0.838-0.142-1.256-0.174c-0.561-0.047-1.117-0.078-1.678-0.081c-0.645-0.002-1.287,0.029-1.928,0.063	c-0.355,0.021-0.709,0.066-1.066,0.11c-0.164,0.02-0.342,0.042-0.5,0.091c-0.357,0.105-0.712,0.214-1.063,0.348	c-0.313,0.122-0.709,0.455-0.671,0.877c0.052,0.533,0.052,1.075,0.091,1.611c0.024,0.379,0.066,0.756,0.104,1.133	c0.025,0.235,0.047,0.474,0.098,0.706c0.102,0.457,0.217,0.916,0.338,1.373c0.15,0.561,0.291,1.132,0.477,1.686	c0.183,0.543,0.392,1.079,0.629,1.597c0.275,0.614,0.576,1.213,0.9,1.8c0.252,0.448,0.549,0.875,0.848,1.296	c0.229,0.329,0.51,0.628,0.742,0.956c0.293,0.4,0.936,0.541,1.314,0.184c0.104-0.095,0.211-0.193,0.301-0.301	c0.371-0.443,0.406-0.937,0.053-1.425c-0.271-0.376-0.523-0.763-0.77-1.15c-0.246-0.377-0.494-0.75-0.729-1.134	c-0.186-0.3-0.357-0.608-0.51-0.925c-0.182-0.381-0.334-0.771-0.492-1.161c-0.174-0.421-0.371-0.829-0.506-1.258	c-0.172-0.582-0.334-1.171-0.438-1.77c-0.088-0.512-0.084-1.042-0.117-1.562c-0.016-0.21,0.094-0.326,0.283-0.357	c0.188-0.039,0.322,0.076,0.361,0.244c0.078,0.307,0.131,0.62,0.164,0.934c0.078,0.716,0.234,1.412,0.455,2.092	c0.209,0.612,0.414,1.23,0.652,1.828C37.756,20.771,37.994,21.194,38.234,21.691z M38.434,29.26c0.08,0.407-0.021,1.235-0.188,1.671	c-0.139,0.369-0.268,0.748-0.404,1.12c-0.16,0.421-0.307,0.848-0.498,1.258c-0.236,0.487-0.498,0.967-0.76,1.44	c-0.344,0.617-0.691,1.227-1.053,1.832c-0.174,0.293-0.189,0.768-0.004,1.033c0.225,0.322,0.482,0.598,0.854,0.764	c0.324,0.148,0.82,0.039,1.016-0.248c0.311-0.443,0.637-0.875,0.936-1.328c0.262-0.4,0.516-0.809,0.732-1.23	c0.264-0.504,0.49-1.025,0.721-1.549c0.105-0.234,0.211-0.473,0.293-0.714c0.125-0.362,0.244-0.724,0.342-1.091	c0.133-0.49,0.279-0.976,0.365-1.472c0.1-0.521,0.133-1.057,0.207-1.583c0.012-0.068,0.098-0.161,0.16-0.169	c0.412-0.076,0.832-0.132,1.244-0.191c0.521-0.081,1.016-0.223,1.449-0.538c0.049-0.03,0.098-0.092,0.098-0.14	c0.008-0.288,0.027-0.574-0.014-0.854c-0.102-0.678-0.217-1.345-0.342-2.014c-0.076-0.369-0.164-0.739-0.297-1.084	c-0.143-0.41-0.342-0.802-0.523-1.19c-0.115-0.23-0.252-0.449-0.381-0.691c-0.064,0.068-0.109,0.098-0.133,0.144	c-0.148,0.292-0.281,0.585-0.43,0.871c-0.18,0.354-0.365,0.705-0.551,1.055c-0.248,0.463-0.473,0.944-0.756,1.381	c-0.418,0.638-0.875,1.216-1.701,1.39c-0.557,0.116-1.029,0.009-1.436-0.353c-0.609-0.53-1.078-1.182-1.498-1.875	c-0.197-0.327-0.393-0.655-0.568-0.994c-0.264-0.497-0.502-1.004-0.75-1.503c-0.028-0.031-0.063-0.058-0.094-0.086	c-0.015,0.058-0.025,0.123-0.051,0.176c-0.107,0.213-0.228,0.421-0.33,0.636c-0.168,0.345-0.338,0.688-0.474,1.04	c-0.103,0.266-0.165,0.549-0.233,0.824c-0.082,0.351-0.16,0.699-0.229,1.051c-0.031,0.146-0.043,0.295-0.049,0.445	c-0.042,0.541-0.083,1.088-0.111,1.631c-0.004,0.066,0.06,0.151,0.117,0.206c0.447,0.364,0.982,0.53,1.535,0.644	c0.312,0.059,0.635,0.074,0.953,0.105c0.162,0.015,0.254,0.072,0.26,0.259c0.012,0.359,0.027,0.723,0.102,1.071	c0.119,0.55,0.275,1.096,0.439,1.635c0.059,0.193,0.184,0.362,0.309,0.602c0.635-1.091,0.768-2.246,0.961-3.386	C37.934,29.26,38.176,29.26,38.434,29.26z M29.203,24.702c-0.089,0.067-0.139,0.093-0.168,0.131	c-0.166,0.236-0.319,0.492-0.499,0.718c-0.276,0.347-0.56,0.69-0.857,1.021c-0.346,0.375-0.683,0.77-1.178,0.979	c-0.212,0.086-0.414,0.176-0.431,0.45c-0.029,0.381-0.057,0.762-0.103,1.139c-0.031,0.23-0.093,0.461-0.147,0.687	c-0.066,0.284-0.135,0.558-0.208,0.838c-0.077,0.286-0.148,0.578-0.241,0.866c-0.122,0.373-0.251,0.746-0.395,1.112	c-0.163,0.415-0.331,0.836-0.529,1.23c-0.22,0.449-0.47,0.872-0.718,1.299c-0.232,0.395-0.45,0.801-0.734,1.16	c-0.396,0.49-0.37,1.029-0.142,1.52c0.247,0.527,0.678,0.916,1.339,0.871c0.235-0.021,0.492,0.045,0.675-0.158	c0.247-0.277,0.504-0.541,0.716-0.834c0.109-0.154,0.135-0.109,0.232-0.012c0.188,0.186,0.406,0.361,0.687,0.342	c0.16-0.008,0.324-0.09,0.46-0.182c0.34-0.213,0.6-0.582,0.564-1.021c-0.038-0.455-0.276-0.777-0.566-1.094	c-0.056-0.061-0.101-0.191-0.075-0.258c0.269-0.648,0.563-1.279,0.834-1.929c0.15-0.354,0.278-0.718,0.398-1.079	c0.102-0.318,0.175-0.634,0.263-0.954c0.063-0.238,0.139-0.479,0.188-0.723c0.078-0.401,0.148-0.802,0.208-1.202	c0.091-0.606,0.172-1.217,0.256-1.823c0.011-0.089,0-0.185,0.019-0.271C29.253,26.618,29.203,25.697,29.203,24.702z M24.073,32.769	c0.02,0.004,0.042,0.004,0.061,0.004c0.042-0.076,0.094-0.145,0.124-0.226c0.113-0.291,0.226-0.576,0.325-0.871	c0.136-0.404,0.277-0.805,0.38-1.216c0.117-0.468,0.203-0.949,0.286-1.433c0.074-0.404,0.123-0.815,0.175-1.225	c0.009-0.076-0.002-0.191-0.051-0.229c-0.358-0.315-0.737-0.609-1.096-0.929c-0.26-0.227-0.516-0.473-0.747-0.741	c-0.239-0.274-0.448-0.578-0.7-0.907C22.699,27.71,23.267,30.257,24.073,32.769z M40.393,38.515c0.039,0,0.072,0.012,0.115-0.002	c0.488-0.115,0.846-0.422,1.117-0.842c0.166-0.262,0.285-0.557,0.232-0.869c-0.066-0.381-0.184-0.762-0.432-1.078	c-0.281-0.361-0.582-0.705-0.941-0.982c-0.109-0.084-0.199-0.096-0.234,0.08c-0.021,0.107-0.053,0.227-0.098,0.336	c-0.287,0.672-0.537,1.363-0.992,1.957c-0.066,0.086-0.063,0.297-0.006,0.412c0.084,0.186,0.23,0.35,0.369,0.508	C39.754,38.294,40.033,38.489,40.393,38.515z M28.752,8.48c0,1.408-1.142,2.549-2.548,2.549c-1.407,0-2.546-1.141-2.546-2.549	c0-1.405,1.139-2.546,2.546-2.546C27.611,5.934,28.752,7.075,28.752,8.48z M40.822,8.779c0,1.407-1.143,2.546-2.547,2.546	c-1.406,0-2.545-1.14-2.545-2.546c0-1.406,1.139-2.548,2.545-2.548C39.68,6.231,40.822,7.374,40.822,8.779z"/></svg>';
const iconUserSGV = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="64" height="64" viewBox="0 0 24 24"><defs><path id="a" fill="#8a2be2" d="M0 0h24v24H0V0z"/></defs><clipPath id="b"><use xlink:href="#a" overflow="visible"/></clipPath><path clip-path="url(#b)" fill="#8a2be2" d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm0 2c1.1 0 2 .9 2 2 0 1.11-.9 2-2 2s-2-.89-2-2c0-1.1.9-2 2-2zm0 10c-1.67 0-3.14-.85-4-2.15.02-1.32 2.67-2.05 4-2.05s3.98.73 4 2.05c-.86 1.3-2.33 2.15-4 2.15z"/></svg>';

let posActual;
let BanosArray = [
    {id:'1234567890', "nombre":"Eco Baños", "direccion":"Estado 149-197, Santiago, Región Metropolitana","lat":-33.441125, "lng":-70.649226},//-33.441125, -70.649226
    {id:'1234567890', "nombre":"Eco Baños subterraneo", "direccion":"Paseo Ahumada 360, Santiago, Región Metropolitana","lat":-33.438974 , "lng":-70.651071},//-33.438974, -70.651071
    {id:'1234567890', "nombre":"Baños Publicos", "direccion":"Chacabuco, Maipú, Región Metropolitana","lat":-33.508946, "lng":-70.756036}//-33.508946, -70.756036
//aqui    
];
let primeraLectura = false;

//Paso 1: inicializar la plataforma
platform = new H.service.Platform({
    'app_id': 'xp2LMzBFCMvdU9TNRRjY',
    'app_code': 'w1p60cUN3oTM8VhpR1B0ww',
    useHTTPS: true
 });

let pixelRatio = window.devicePixelRatio || 1;
let defaultLayers = platform.createDefaultLayers({
 tileSize: pixelRatio === 1 ? 256 : 512,
 ppi: pixelRatio === 1 ? undefined : 320
});

//Paso 2: inicializar el mapa, pre configurando un lugar y zoom
let map = new H.Map(document.getElementById('mapContainer'),
 defaultLayers.normal.map,{
 center: {lat: -33.4189088, lng: -70.6422443},
 zoom: 16,
 pixelRatio: pixelRatio
});

//Paso 3: hacer el mapa interactivo
// MapEvents obtener eventos del sistema
// Behavior implementa el pan/zoom 
let behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

// crea la interfaces de usuario por defecto en el mapa 
let ui = H.ui.UI.createDefault(map, defaultLayers);

let iconoUser = new H.map.Icon(iconUserSGV);
var banoIcon = new H.map.Icon(iconBano);

//Paso 4:Icono de usuario
//crea una marca con la posicion indicada
let markerUser = new H.map.Marker({ lat: -33.4189088, lng: -70.6422443 }, { icon: iconoUser });
map.addObject(markerUser);

let radioAccion = new H.map.Circle(
    // Centro del circulo
    { lat: -33.4189088, lng: -70.6422443 },
    // radio del circulo en metros
    250,
    {
      style: {
        strokeColor: 'rgba(55, 85, 170, 0)', // color de la orilla del circulo
        lineWidth: 0, //ancho de la orilla
        fillColor: 'rgba(255,255,191, 0.4)'  // color de fondo del circulo
      }
    }
  );

map.addObject(radioAccion);

optionsGPS = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
   };
function errorLocation(error){
    console.log(error);
}

console.log("Inicia Navegador");
if ('geolocation' in navigator) {
    navigator.geolocation.getCurrentPosition(function (location) {
        updaeteLocation(location);
    },errorLocation, optionsGPS);
    watchId = navigator.geolocation.watchPosition(updaeteLocation, errorLocation, optionsGPS);
} else {
    console.log('Geolocation API not supported.');
}

function updaeteLocation(position) {
    map.setCenter({lat:position.coords.latitude, lng:position.coords.longitude});//centra el mapa en la posicion del usuario
    markerUser.setPosition({lat:position.coords.latitude, lng:position.coords.longitude});//centra la marca en la posicion del usuario
    radioAccion.setCenter({lat:position.coords.latitude, lng:position.coords.longitude});//centra el circulo en la posicion del usuario
    posActual = {lat:position.coords.latitude, lng:position.coords.longitude};
    console.log(position);
    if(!primeraLectura){
        primeraLectura = true;
        crearListado(BanosArray);
    }
 }

 function ruta(i,newPos){
    removeAllObject();
    activarRuta(posActual, newPos);
    showPanelQR(i, BanosArray);
}

 function activarRuta(posInicial, posFinal) {
    console.log('waypoint0 : geo!' + posInicial.lat + ', ' + posInicial.lng);
    console.log('waypoint1 : geo!' + posFinal.lat + ', ' + posFinal.lng);

    var routingParameters = {
        'mode': 'fastest;pedestrian',//'fastest;car',
        'waypoint0': 'geo!' + posInicial.lat + ',' + posInicial.lng,
        'waypoint1': 'geo!' + posFinal.lat + ',' + posFinal.lng,
        'representation': 'display'
    };

    var onResult = function (result) {
        var route,
            routeShape,
            startPoint,
            endPoint,
            linestring;
        if (result.response.route) {
            route = result.response.route[0];
            routeShape = route.shape;
            linestring = new H.geo.LineString();

            routeShape.forEach(function (point) {
                var parts = point.split(',');
                linestring.pushLatLngAlt(parts[0], parts[1]);
            });
            startPoint = route.waypoint[0].mappedPosition;
            endPoint = route.waypoint[1].mappedPosition;

            var routeLine = new H.map.Polyline(linestring, {
                style: { strokeColor: 'green', lineWidth: 5 }
            });
            var startMarker = new H.map.Marker({
                lat: startPoint.latitude,
                lng: startPoint.longitude
            });

            let positionFinal = {
                lat: endPoint.latitude,
                lng: endPoint.longitude
            };

            let endMarker = new H.map.Marker(positionFinal, { icon: banoIcon });
            map.addObjects([routeLine, startMarker, endMarker]);
            map.setViewBounds(routeLine.getBounds());
        }
    };

    let router = platform.getRoutingService();
    router.calculateRoute(routingParameters, onResult,
        function (error) {
            alert(error.message);
        });
}

function removeAllObject(){
    for (object of map.getObjects()){
     if (object!=markerUser){
         map.removeObject(object);
        }
     }
 }

 function crearListado(arrayData){
    const fileContainer = document.getElementById("fileContainer");
    fileContainer.innerHTML = "";
    for (let i = 0 ; i < arrayData.length;i++){
        let markerBano = new H.map.Marker({ lat: arrayData[i].lat, lng: arrayData[i].lng }, { icon: banoIcon });
        map.addObject(markerBano);
        
        let fila = `
            <div class="row p-3">
            <div class="card col-12 p-0">
                <div class="card-header">
                    <h5 class="d-inline float-left m-0 p-1">${arrayData[i].nombre}</h5>
                    <a href="#" onclick='ruta(${i},{"lat":"${arrayData[i].lat}", "lng":"${arrayData[i].lng}"})' class="btn bg-info d-inline float-right rounded-circle text-white">IR</a>
                </div>
                <div class="card-body h-25">
                    <div class="d-inline-block align-top" style="height: 100px;">
                        <img class="img-fluid rounded mh-100"  style="width: 100px; height: 100px;" src="../img/Banio.jpg" class="rounded float-left" alt="">
                    </div>
                    <div class="d-inline-block ml-3">
                        <h6 class="card-title">Dirección</h6>
                        <p id="direccion" class="card-text">${arrayData[i].direccion}</p>
                        <p id="distancia" class="card-text">Distancia ${getKilometros(arrayData[i].lat,arrayData[i].lng )} km</p>
                    </div>
                </div>
            </div>
        </div>`;
        fileContainer.innerHTML += fila;
    } 
}

function showPanelQR(index, data){
    const fileContainer = document.getElementById("fileContainer");
    fileContainer.innerHTML = "";
    let fila = `
        <div class="row p-3">
            <div class="card col-12 p-0">
                <div class="card-header">
                    <h5 class="d-inline float-left m-0 p-1">${data[index].nombre}</h5>
                    <a href="#" onclick='gotoQR()' class="btn bg-info d-inline float-right rounded-circle text-white">IR</a>
                </div>
                <div class="card-body h-25">
                    <div class="d-inline-block align-top" style="height: 100px;">
                        <img class="img-fluid rounded mh-100"  style="width: 100px; height: 100px;" src="../img/Banio.jpg" class="rounded float-left" alt="">
                    </div>
                    <div class="d-inline-block ml-3">
                        <h6 class="card-title">Dirección</h6>
                        <p id="direccion" class="card-text">${data[index].direccion}</p>
                        <p id="distancia" class="card-text">Distancia ${getKilometros(data[index].lat,data[index].lng)} km</p>
                    </div>
                </div>
            </div>
        </div>`;
    fileContainer.innerHTML += fila;

    localStorage.setItem("selectedBano",JSON.stringify(data[index]));
    localStorage.setItem("selectId", data[index].id);
}

function gotoQR(){
    window.location.href = "qr.html";
}


function getKilometros (lat2,lon2){
    let lat1 = posActual.lat;
    let lon1 = posActual.lng;

    rad = function(x) {return x*Math.PI/180;}
    var R = 6378.137; //Radio de la tierra en km
    var dLat = rad( lat2 - lat1 );
    var dLong = rad( lon2 - lon1 );
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(rad(lat1)) * Math.cos(rad(lat2)) * Math.sin(dLong/2) * Math.sin(dLong/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c;
    return d.toFixed(3); //Retorna tres decimales
}